# 仙家短链系统架构设计

## 1. 系统架构
```mermaid
graph TD
    A[客户端] --> B[API网关]
    B --> C[短链服务]
    B --> D[统计服务]
    C --> E[缓存层]
    C --> F[持久层]
    D --> F
```

## 2. 核心模块
### 2.1 短链服务
- 职责：长链接转短链接
- 核心类：`ShortUrlService`
- 依赖：`CacheManager`, `DBModel`

### 2.2 统计服务
- 职责：访问统计
- 核心类：`VisitCounter`
- 存储：Redis + MySQL

### 2.3 缓存层
- 实现：Redis驱动
- 策略：LRU缓存淘汰
- 接口：`CacheInterface`

### 2.4 持久层
- 数据库：MySQL
- 分表策略：按短链hash分片
- 驱动：`MysqlDriver`

## 3. 关键流程
### 3.1 生成短链
```mermaid
sequenceDiagram
    客户端->>+短链服务: 提交长链接
    短链服务->>+缓存: 检查是否存在
    缓存-->>-短链服务: 返回结果
    短链服务->>+数据库: 写入记录
    数据库-->>-短链服务: 返回ID
    短链服务->>+客户端: 返回短链
```

### 3.2 访问短链
```mermaid
sequenceDiagram
    客户端->>+API网关: 访问短链
    API网关->>+短链服务: 解析短链
    短链服务->>+统计服务: 记录访问
    统计服务-->>-短链服务: 确认
    短链服务-->>-API网关: 返回长链接
    API网关->>+客户端: 302重定向
```

## 4. 性能优化
- 缓存预热
- 连接池
- 异步写入

## 5. 扩展性设计
- 水平扩展：无状态服务
- 插件机制：驱动可替换
- 配置热更新